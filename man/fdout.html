<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>libdill</title>
  <link rel="stylesheet" type="text/css" href="http://libdill.org/main.css">
</head>
<body>

<h1>libdill: Structured Concurrency for C</h1>

<ul id='toplist'>
<li><a href="http://libdill.org/index.html">Home</a></li>
<li><a href="http://libdill.org/download.html">Download</a></li>
<li><a href="http://libdill.org/documentation.html">Documentation</a></li>
<li><a href="http://libdill.org/tutorial.html">Tutorial</a></li>
</ul>
<h1 id="name">NAME</h1>
<p>fdout - waits while file descriptor becomes writeable</p>
<h1 id="synopsis">SYNOPSIS</h1>
<pre class="sourceCode c"><code class="sourceCode c"><span class="ot">#include &lt;libdill.h&gt;</span>
<span class="dt">int</span> fdout(<span class="dt">int</span> fd, <span class="dt">int64_t</span> deadline);</code></pre>
<h1 id="description">DESCRIPTION</h1>
<p>Waits until file descriptor becomes writeable or until it gets into an error state. Both options cause successful return from the function. To distinguish between the two outcomes you have to do subsequent write operation on the file descriptor.</p>
<p><code>deadline</code> is a point in time when the operation should time out. Use <code>now</code> function to get current point in time. 0 means immediate timeout, i.e. return immediately if file descriptor is writeable, return without blocking if it is not. -1 means no deadline, i.e. the call will block forever, if needed.</p>
<h1 id="return-value">RETURN VALUE</h1>
<p>The function returns 0 in case of success or -1 in case of error. In the latter case is sets <code>errno</code> to one of the following values.</p>
<h1 id="errors">ERRORS</h1>
<ul>
<li><code>EBADF</code>: Not a file descriptor.<br /></li>
<li><code>EBUSY</code>: Another coroutine is already blocked on <code>fdout</code> with this file descriptor.<br /></li>
<li><code>ECANCELED</code>: Current coroutine is being shut down.<br /></li>
<li><code>ETIMEDOUT</code>: Deadline expired while waiting for the file descriptor.</li>
</ul>
<h1 id="example">EXAMPLE</h1>
<pre class="sourceCode c"><code class="sourceCode c"><span class="dt">void</span> sendbuf(<span class="dt">int</span> fd, <span class="dt">const</span> <span class="dt">char</span> *buf, size_t len) {
    <span class="dt">int</span> result = fcntl(fd, F_SETFL, O_NONBLOCK);
    assert(result == <span class="dv">0</span>);
    <span class="kw">while</span>(len) {
        result = fdout(fd, -<span class="dv">1</span>);
        assert(result == <span class="dv">0</span>);
        ssize_t sent = send(fd, buf, len, <span class="dv">0</span>);
        assert(len &gt; <span class="dv">0</span>);
        buf += sent;
        len -= sent;
    }
}</code></pre>
</body>
